<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICouncil</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/vendor/html2canvas.min.js"></script>
    <script src="/static/vendor/jspdf.umd.min.js"></script>
    <style>
        .role-leader { border-left: 4px solid #3b82f6; }
        .role-planner { border-left: 4px solid #10b981; }
        .role-auditor { border-left: 4px solid #f59e0b; }
        .role-reporter { border-left: 4px solid #8b5cf6; }
        .role-devils_advocate { border-left: 4px solid #ef4444; background-color: #fef2f2; }
        .role-reference_refiner { border-left: 4px solid #06b6d4; background-color: #ecfeff; }
        .markdown-body h1 { font-size: 1.5rem; font-weight: bold; margin-top: 1rem; }
        .markdown-body h2 { font-size: 1.25rem; font-weight: bold; margin-top: 0.75rem; }
        .markdown-body p { margin-bottom: 0.5rem; }
        .markdown-body ul { list-style-type: disc; margin-left: 1.5rem; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.875rem; }
        .markdown-body th, .markdown-body td { border: 1px solid #e2e8f0; padding: 0.5rem; text-align: left; }
        .markdown-body th { background-color: #f8fafc; font-weight: bold; }
        .markdown-body tr:nth-child(even) { background-color: #f8fafc; }
        .markdown-body {
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        /* æ™ºèƒ½æ··åˆæ¸²æŸ“ç»„ä»¶æ ·å¼ */
        .smart-render-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        .smart-render-header {
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .smart-render-header-icon {
            font-size: 1rem;
        }
        .smart-render-header-title {
            color: #475569;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .smart-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .smart-card:last-child {
            margin-bottom: 0;
        }
        .smart-card-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .smart-card-header:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        .smart-card-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }
        .smart-card-title-icon {
            font-size: 0.875rem;
        }
        .smart-card-badge {
            font-size: 0.65rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            background: #e2e8f0;
            color: #64748b;
        }
        .smart-card-content {
            padding: 0.75rem;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
        }
        .smart-card-content.collapsed {
            max-height: 0;
            opacity: 0;
            padding: 0 0.75rem;
            overflow: hidden;
        }
        /* é€šç”¨æŠ˜å ç±» */
        .collapsed {
            display: none !important;
        }
        .smart-card-content.collapsed {
            display: block !important;
        }
        .smart-card-toggle {
            color: #94a3b8;
            font-size: 0.75rem;
            transition: transform 0.2s;
        }
        
        /* é”®å€¼å¯¹ç½‘æ ¼ */
        .smart-kv-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.375rem 0.75rem;
            align-items: start;
        }
        .smart-kv-key {
            color: #64748b;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 0.25rem 0;
        }
        .smart-kv-value {
            color: #1e293b;
            font-size: 0.8rem;
            padding: 0.25rem 0;
            word-break: break-word;
        }
        .smart-kv-value-long {
            background: #f8fafc;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #e2e8f0;
            max-height: 100px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .smart-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        .smart-table th {
            background: #f1f5f9;
            color: #475569;
            font-weight: 600;
            padding: 0.5rem 0.75rem;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }
        .smart-table td {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid #f1f5f9;
            color: #334155;
            vertical-align: top;
        }
        .smart-table tr:last-child td {
            border-bottom: none;
        }
        .smart-table tr:hover td {
            background: #f8fafc;
        }
        
        /* åˆ—è¡¨æ ·å¼ */
        .smart-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .smart-list-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.375rem 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.8rem;
            color: #334155;
        }
        .smart-list-item:last-child {
            border-bottom: none;
        }
        .smart-list-number {
            min-width: 1.25rem;
            height: 1.25rem;
            background: #e2e8f0;
            color: #64748b;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 600;
            flex-shrink: 0;
        }
        .smart-list-bullet {
            width: 0.375rem;
            height: 0.375rem;
            background: #94a3b8;
            border-radius: 9999px;
            flex-shrink: 0;
            margin-top: 0.4rem;
        }
        
        /* Badgeæ ·å¼ */
        .smart-badge {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .smart-badge-red { background: #fee2e2; color: #dc2626; }
        .smart-badge-green { background: #dcfce7; color: #16a34a; }
        .smart-badge-yellow { background: #fef9c3; color: #ca8a04; }
        .smart-badge-blue { background: #dbeafe; color: #2563eb; }
        .smart-badge-purple { background: #f3e8ff; color: #9333ea; }
        .smart-badge-gray { background: #f1f5f9; color: #64748b; }
        
        /* é«˜äº®æ ·å¼ */
        .smart-highlight-error .smart-card-header {
            border-left: 3px solid #ef4444;
        }
        .smart-highlight-success .smart-card-header {
            border-left: 3px solid #22c55e;
        }
        .smart-highlight-rating .smart-card-header {
            border-left: 3px solid #eab308;
        }
        
        .search-progress-card {
            margin: 0.75rem 0;
            transition: all 0.3s ease;
        }
        .search-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.25rem 0.5rem;
            background-color: rgba(219, 234, 254, 0.5); /* bg-blue-100/50 */
            border-left: 2px solid #bfdbfe; /* border-blue-200 */
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .search-header:hover {
            background-color: rgba(191, 219, 254, 0.5); /* bg-blue-200/50 */
        }
        .search-header h5 {
            color: #1d4ed8; /* text-blue-700 */
            font-weight: 800;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0;
            display: flex;
            align-items: center;
        }
        .search-content {
            padding: 0.75rem;
            background-color: rgba(239, 246, 255, 0.4); /* bg-blue-50/40 */
            border-left: 2px solid #bfdbfe; /* border-blue-200 */
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            font-size: 13px;
            line-height: 1.6;
            color: #475569; /* text-slate-600 */
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
            max-height: 300px;
            overflow-y: auto;
        }
        .search-content.collapsed {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin: 0;
            border-bottom: none;
            overflow: hidden;
        }
        .event-reasoning {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
            max-height: 300px;
            overflow-y: auto;
        }
        .event-reasoning.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-bottom: 0;
            opacity: 0;
            border: none;
            overflow: hidden;
        }

        .discussion-card {
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
        }

        .event-content, .event-reasoning {
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .event-reasoning::-webkit-scrollbar,
        .search-content::-webkit-scrollbar {
            width: 4px;
        }
        .event-reasoning::-webkit-scrollbar-track,
        .search-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .event-reasoning::-webkit-scrollbar-thumb,
        .search-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .event-reasoning::-webkit-scrollbar-thumb:hover,
        .search-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* æœ€å¤§åŒ–æ ·å¼ */
        .maximized {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 1000 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            background: white;
        }

        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            min-width: 140px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 50;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            padding: 0.5rem 0;
        }

        /* åŠ¨æ€å¸ƒå±€å®½åº¦ */
        #main-layout.discussion-wide #discussion-section {
            flex: 2;
        }
        #main-layout.discussion-wide #report-section {
            flex: 1;
        }
        #main-layout.report-wide #discussion-section {
            flex: 1;
        }
        #main-layout.report-wide #report-section {
            flex: 2;
        }

        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            min-width: 140px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 100;
            border-radius: 0.75rem;
            overflow: hidden;
            margin-top: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        .dropdown-content button {
            width: 100%;
            text-align: left;
            padding: 0.6rem 1rem;
            color: #475569;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .dropdown-content button:hover {
            background-color: #f8fafc;
            color: #2563eb;
        }
        .dropdown-content button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: transparent;
            color: #94a3b8;
        }
        .show { display: block; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <nav class="bg-slate-800 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="px-4 flex justify-between items-center">
            <h1 class="text-3xl font-black tracking-tighter">ğŸ›ï¸ <span data-i18n="nav_title">AI Council</span> <span class="text-lg font-normal text-slate-400 ml-3 tracking-normal" data-i18n="nav_subtitle">å…ƒè€é™¢è®®äº‹å…</span></h1>
            <div class="flex items-center space-x-4">
                <!-- è¯­è¨€åˆ‡æ¢ -->
                <div class="flex bg-slate-700/50 rounded-lg p-1 border border-slate-600">
                    <button onclick="setLanguage('zh')" id="lang-zh" class="px-2 py-1 text-xs rounded transition-all duration-200 font-bold">ä¸­</button>
                    <button onclick="setLanguage('en')" id="lang-en" class="px-2 py-1 text-xs rounded transition-all duration-200 font-bold">EN</button>
                </div>
                <!-- Meta-Orchestrator æ¨¡å¼åˆ‡æ¢ -->
                <div class="flex items-center space-x-2 bg-slate-700/50 px-3 py-2 rounded-lg border border-slate-600">
                    <span class="text-xs font-semibold text-slate-300" data-i18n="nav_orchestrator_mode">æ™ºèƒ½ç¼–æ’</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="orchestrator-mode-toggle" class="sr-only peer" onchange="toggleOrchestratorMode()">
                        <div class="w-9 h-5 bg-slate-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                    </label>
                </div>
                <div id="status-indicator" class="flex items-center space-x-3 bg-slate-700/50 px-4 py-2 rounded-full border border-slate-600">
                    <span id="status-dot" class="w-3 h-3 bg-gray-500 rounded-full"></span>
                    <span id="status-text" class="text-base" data-i18n="status_ready">å°±ç»ª</span>
                    <span id="browser-warning" class="hidden text-amber-400 cursor-help" title="æœªæ‰¾åˆ°æµè§ˆå™¨ï¼Œæœç´¢åŠŸèƒ½å¯èƒ½å—é™" data-i18n-title="msg_browser_missing">âš ï¸</span>
                </div>
                <button onclick="toggleLogs()" class="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg border border-slate-600 transition group" title="åˆ‡æ¢æ—¥å¿—æ˜¾ç¤º" data-i18n-title="nav_toggle_logs">
                    <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </button>
                <button onclick="toggleRolesModal()" class="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg border border-slate-600 transition group" title="è§’è‰²ç®¡ç†" data-i18n-title="nav_roles">
                    <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </button>
                <button id="advanced-config-btn" onclick="toggleAdvancedConfigModal()" class="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg border border-slate-600 transition group" title="é«˜çº§é…ç½®" data-i18n-title="btn_advanced">
                    <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
                <button id="history-btn" class="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg border border-slate-600 transition group" title="å†å²" data-i18n-title="btn_history">
                    <svg class="w-5 h-5 text-slate-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </button>
                <!-- ç®¡ç†å‘˜å…¥å£ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰ -->
                <a id="admin-btn" href="/admin" class="hidden p-2 bg-purple-600 hover:bg-purple-700 rounded-lg border border-purple-500 transition group" title="ç®¡ç†å‘˜è®¾ç½®">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                </a>
                <button onclick="logout()" class="p-2 bg-red-600 hover:bg-red-700 rounded-lg border border-red-500 transition group" title="ç™»å‡º" data-i18n-title="btn_logout">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto py-4 px-4 max-w-[98vw] h-[calc(100vh-80px)] flex flex-col">
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-4 border border-slate-200 flex-shrink-0">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-bold text-slate-500 uppercase mb-1" data-i18n="input_issue_label">è®®é¢˜å†…å®¹</label>
                    <textarea id="issue-input" placeholder="è¯·è¾“å…¥æ‚¨æƒ³è¦è®¨è®ºçš„è®®é¢˜ï¼ˆæ”¯æŒå¤šè¡Œè¾“å…¥ï¼ŒEnter å‘é€ï¼ŒShift+Enter æ¢è¡Œï¼‰..." rows="1"
                           data-i18n-placeholder="input_issue_placeholder"
                           class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-base resize-none min-h-[42px] max-h-48 overflow-y-auto"
                           oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                </div>
                <div class="flex items-end space-x-2">
                    <!-- éšè—çš„é…ç½®å­—æ®µï¼ˆç”¨äºåç«¯é€»è¾‘ï¼Œå®é™…å€¼ä»modalåŒæ­¥ï¼‰ -->
                    <input type="hidden" id="backend-select" value="deepseek">
                    <input type="hidden" id="global-model-input">
                    <input type="hidden" id="global-reasoning-input">
                    <input type="hidden" id="rounds-input" value="3">
                    <input type="hidden" id="planners-input" value="2">
                    <input type="hidden" id="auditors-input" value="2">
                    <div id="global-reasoning-container" class="hidden"></div>
                    
                    <button id="start-btn" onclick="startDiscussion()" 
                            class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-8 rounded-lg transition shadow-lg shadow-blue-200 disabled:bg-gray-400 disabled:shadow-none flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span data-i18n="btn_start">å¼€å§‹è®®äº‹</span>
                    </button>
                    <button id="stop-btn" onclick="stopDiscussion()" 
                            class="hidden w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-8 rounded-lg transition shadow-lg shadow-red-200" data-i18n="btn_stop">
                        åœæ­¢
                    </button>
                </div>
            </div>
            <!-- datalists for autocomplete -->
            <datalist id="openrouter-models-list"></datalist>
            <datalist id="deepseek-models-list"></datalist>
        </div>

        <div id="main-layout" class="flex flex-col lg:flex-row gap-4 flex-1 min-h-0">
            <!-- å·¦ä¾§è®¨è®ºæµ (å›ºå®š50%å®½åº¦) -->
            <div id="discussion-section" class="flex flex-col min-h-0 transition-all duration-300 w-full lg:w-1/2">
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 flex flex-col flex-1 min-h-0 overflow-hidden">
                    <div class="bg-slate-50 px-4 py-3 border-b border-slate-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-slate-700 flex items-center text-base">
                                <span class="mr-2">ğŸ’¬</span> <span data-i18n="discussion_flow_title">è®®äº‹è¿‡ç¨‹</span>
                                <span id="round-info" class="ml-2 text-xs font-normal text-slate-400 hidden">Round 1 / 3</span>
                            </h3>
                            <div class="flex items-center space-x-2">
                                <span id="progress-percentage" class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">0%</span>
                                <button onclick="toggleMaximize('discussion-section')" class="p-1 hover:bg-slate-200 rounded transition text-slate-400 hover:text-slate-600" title="æœ€å¤§åŒ–/è¿˜åŸ" data-i18n-title="btn_maximize">
                                    <svg id="discussion-maximize-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-1.5 overflow-hidden">
                            <div id="progress-bar" class="bg-blue-500 h-full w-0 transition-all duration-500 ease-out"></div>
                        </div>
                    </div>
                    <div id="discussion-container" class="p-4 overflow-y-auto flex-1 space-y-4 bg-gray-50/50">
                        <div id="discussion-flow" class="space-y-4">
                            <!-- åŠ¨æ€æ’å…¥å†…å®¹ -->
                        </div>
                    </div>
                    <!-- ç”¨æˆ·å¹²é¢„è¾“å…¥åŒº -->
                    <div id="intervention-area" class="hidden p-3 border-t border-slate-200 bg-white">
                        <div class="flex space-x-2">
                            <input type="text" id="intervention-input" 
                                   placeholder="è¾“å…¥å¹²é¢„æŒ‡ä»¤ï¼ˆä¾‹å¦‚ï¼šè¯·æ›´å¤šå…³æ³¨æˆæœ¬é—®é¢˜ï¼‰..." 
                                   data-i18n-placeholder="intervention_placeholder"
                                   class="flex-1 px-3 py-2 border border-slate-300 rounded-lg outline-none text-sm focus:border-blue-500 transition"
                                   onkeyup="if(event.keyCode===13) sendIntervention()">
                            <button onclick="sendIntervention()" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition shadow-sm" data-i18n="btn_send_intervention">
                                å‘é€å¹²é¢„
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§æœ€ç»ˆæŠ¥å‘Š (å›ºå®š50%å®½åº¦) -->
            <div id="report-section" class="flex flex-col min-h-0 transition-all duration-300 w-full lg:w-1/2">
                <div class="bg-white rounded-xl shadow-lg border border-purple-200 flex flex-col flex-1 min-h-0 overflow-hidden">
                    <div class="bg-purple-600 text-white px-4 py-3 flex justify-between items-center">
                        <h3 class="font-bold flex items-center text-base">
                            <span class="mr-2">ğŸ“œ</span> <span data-i18n="final_report_title">æœ€ç»ˆè®®äº‹æŠ¥å‘Š</span>
                            <!-- ç‰ˆæœ¬é€‰æ‹©ä¸‹æ‹‰æ¡† -->
                            <select id="report-version-select" class="hidden ml-3 text-xs bg-purple-500 border border-purple-400 rounded px-2 py-1 text-white cursor-pointer hover:bg-purple-400 transition" onchange="loadReportVersion(this.value)">
                            </select>
                        </h3>
                        <div id="report-actions" class="flex items-center space-x-2">
                            <button onclick="openReportInNewTab()" class="text-xs bg-emerald-500/90 hover:bg-emerald-600 px-2 py-1 rounded transition disabled:opacity-50 disabled:cursor-not-allowed" data-i18n="btn_open_editor" title="åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æŠ¥å‘Šï¼ˆæ”¯æŒç¼–è¾‘å™¨ï¼‰">ğŸ“ ç¼–è¾‘å™¨</button>
                            <button onclick="reReport()" class="text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition disabled:opacity-50 disabled:cursor-not-allowed" data-i18n="btn_re_report">é‡æ–°ç”ŸæˆæŠ¥å‘Š</button>
                            <button onclick="copyReport()" class="text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition disabled:opacity-50 disabled:cursor-not-allowed" data-i18n="btn_copy">å¤åˆ¶</button>
                            
                            <!-- ä¸‹è½½ä¸‹æ‹‰èœå• -->
                            <div class="relative inline-block text-left">
                                <button onclick="toggleDownloadDropdown()" class="text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed" id="download-dropdown-btn">
                                    <span data-i18n="btn_download">ä¸‹è½½</span>
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div id="download-dropdown" class="dropdown-content">
                                    <button onclick="downloadReport(); toggleDownloadDropdown()" class="flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                        <span data-i18n="btn_download_html">HTML æ ¼å¼</span>
                                    </button>
                                    <button onclick="downloadPDF(event); toggleDownloadDropdown()" class="flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                        <span data-i18n="btn_download_pdf">PDF æ ¼å¼</span>
                                    </button>
                                    <button onclick="downloadImage(event); toggleDownloadDropdown()" class="flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        <span data-i18n="btn_download_image">å›¾ç‰‡æ ¼å¼</span>
                                    </button>
                                    <button onclick="downloadMarkdown(event); toggleDownloadDropdown()" class="flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                        <span data-i18n="btn_download_md">Markdown æ ¼å¼</span>
                                    </button>
                                </div>
                            </div>

                            <button onclick="toggleMaximize('report-section')" class="p-1 hover:bg-white/20 rounded transition text-white/70 hover:text-white" title="æœ€å¤§åŒ–/è¿˜åŸ" data-i18n-title="btn_maximize">
                                <svg id="report-maximize-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div id="report-container" class="relative flex-1 min-h-0 overflow-hidden">
                        <iframe id="report-iframe" class="w-full h-full border-none" srcdoc="<div style='color:#94a3b8; font-style:italic; text-align:center; margin-top:100px; font-family:sans-serif;'></div>"></iframe>
                        <!-- æŠ¥å‘Šç”Ÿæˆé®ç½©å±‚ -->
                        <div id="report-loader" class="hidden absolute inset-0 bg-white/70 backdrop-blur-[1px] flex flex-col items-center justify-center z-10">
                            <div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin mb-4"></div>
                            <p id="loader-text" class="text-purple-700 font-bold animate-pulse text-base" data-i18n="loader_text">æ­£åœ¨è¿›è¡Œè®®äº‹è®¨è®º...</p>
                            <p id="loader-subtext" class="text-slate-400 text-sm mt-2" data-i18n="loader_subtext">å…ƒè€ä»¬æ­£åœ¨æ¿€çƒˆè¾©è®ºä¸­</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§æ—¥å¿—çª—å£ï¼ˆæ”¹ä¸ºæ‚¬æµ®çª—ï¼‰ -->
            <div id="log-section" class="hidden fixed w-96 h-[500px] z-50 flex flex-col" style="top: auto; left: auto; bottom: 1rem; right: 1rem;">
                <div class="bg-slate-900 rounded-xl shadow-2xl overflow-hidden flex flex-col h-full border border-slate-700">
                    <div id="log-header" class="bg-slate-800 px-4 py-3 flex justify-between items-center border-b border-slate-700 cursor-move select-none">
                        <h3 class="text-slate-300 text-sm font-bold flex items-center">
                            <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                            <span data-i18n="log_title">ç³»ç»Ÿæ‰§è¡Œæ—¥å¿—</span>
                        </h3>
                        <div class="flex items-center gap-2">
                            <button onclick="clearLogs()" class="text-xs text-slate-500 hover:text-slate-300" data-i18n="btn_clear">æ¸…é™¤</button>
                            <button onclick="toggleLogs()" class="text-slate-500 hover:text-slate-300 text-lg leading-none">âœ•</button>
                        </div>
                    </div>
                    <div id="log-container" class="p-3 font-mono text-[13px] text-slate-400 overflow-y-auto flex-1 space-y-1">
                        <!-- æ—¥å¿—å†…å®¹ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
        <div id="history-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[120] flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl w-full mx-4 flex flex-col max-h-[80vh]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-slate-800" data-i18n="history_modal_title">è®®äº‹å†å²è®°å½•</h3>
                    <button id="history-close-btn-top" class="text-slate-400 hover:text-slate-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <div id="history-list" class="overflow-y-auto flex-1 space-y-2 pr-2">
                    <!-- å†å²é¡¹åŠ¨æ€æ’å…¥ -->
                    <div class="text-center py-8 text-slate-400 italic" data-i18n="history_loading">æ­£åœ¨åŠ è½½å†å²è®°å½•...</div>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-end">
                    <button id="history-close-btn-bottom" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition" data-i18n="btn_close">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- é€šç”¨ç¡®è®¤æ¨¡æ€æ¡† -->
        <div id="confirm-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[150] flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <div class="text-center">
                    <div id="confirm-icon" class="w-16 h-16 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h3 id="confirm-title" class="text-xl font-bold text-slate-800 mb-2" data-i18n="confirm_title">ç¡®è®¤</h3>
                    <p id="confirm-message" class="text-slate-600 mb-8 text-base"></p>
                    <div class="flex space-x-4">
                        <button id="confirm-cancel-btn" class="flex-1 px-6 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition" data-i18n="btn_cancel">
                            å–æ¶ˆ
                        </button>
                        <button id="confirm-ok-btn" class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200" data-i18n="btn_confirm">
                            ç¡®è®¤
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æç¤ºæ¨¡æ€æ¡† -->
        <div id="alert-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[200] flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <div class="text-center">
                    <div id="alert-icon" class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h3 id="alert-title" class="text-xl font-bold text-slate-800 mb-2" data-i18n="alert_title">æç¤º</h3>
                    <p id="alert-message" class="text-slate-600 mb-8 text-base"></p>
                    <div class="flex">
                        <button onclick="closeAlertModal()" class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200" data-i18n="btn_ok">
                            ç¡®å®š
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯†ç è¾“å…¥æ¨¡æ€æ¡† -->
        <div id="password-input-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[200] flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <div class="text-center">
                    <div class="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <h3 id="password-input-title" class="text-xl font-bold text-slate-800 mb-2">å®‰å…¨éªŒè¯</h3>
                    <p id="password-input-message" class="text-slate-600 mb-4 text-sm">ä¸ºäº†å®‰å…¨ï¼Œè¯·è¾“å…¥æ‚¨çš„å½“å‰å¯†ç ï¼š</p>
                    <div class="mb-6">
                        <input type="password" id="password-input-field" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                               placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <div class="flex space-x-4">
                        <button id="password-input-cancel-btn" class="flex-1 px-6 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                            å–æ¶ˆ
                        </button>
                        <button id="password-input-ok-btn" class="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition shadow-lg shadow-red-200">
                            ç¡®è®¤
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿè®¾ç½®æ¨¡æ€æ¡† -->
        <!-- é«˜çº§é…ç½®æ¨¡æ€æ¡† -->
        <div id="advanced-config-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[150] flex items-center justify-center">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-4xl w-full mx-4 flex flex-col max-h-[85vh]">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center">
                        <span class="mr-2 text-2xl">âš™ï¸</span> <span data-i18n="advanced_config_title">é«˜çº§é…ç½®</span>
                    </h3>
                    <button onclick="toggleAdvancedConfigModal()" class="text-slate-400 hover:text-slate-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- Tab å¯¼èˆª -->
                <div class="flex border-b border-slate-200 mb-6">
                    <button onclick="switchAdvancedTab('basic')" id="tab-basic-btn" 
                            class="px-6 py-3 font-bold text-blue-600 border-b-2 border-blue-600 transition" 
                            data-i18n="tab_basic_config">åŸºç¡€é…ç½®</button>
                    <button onclick="switchAdvancedTab('agents')" id="tab-agents-btn" 
                            class="px-6 py-3 font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition" 
                            data-i18n="tab_agent_config">å¸­ä½ä¸“å®¶é…ç½®</button>
                    <button onclick="switchAdvancedTab('presets')" id="tab-presets-btn" 
                            class="px-6 py-3 font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition" 
                            data-i18n="tab_presets">å…ƒè€é™¢ç¼–åˆ¶</button>
                    <button onclick="switchAdvancedTab('settings')" id="tab-settings-btn" 
                            class="px-6 py-3 font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition" 
                            data-i18n="tab_settings">ç³»ç»Ÿè®¾ç½®</button>
                    <button onclick="switchAdvancedTab('user')" id="tab-user-btn" 
                            class="px-6 py-3 font-bold text-slate-500 hover:text-slate-700 border-b-2 border-transparent transition" 
                            data-i18n="tab_user">ç”¨æˆ·è®¾ç½®</button>
                </div>

                <!-- Tab å†…å®¹å®¹å™¨ -->
                <div class="overflow-y-auto flex-1 pr-2">
                    <!-- åŸºç¡€é…ç½® Tab -->
                    <div id="tab-basic-content" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_backend_label">åç«¯</label>
                                <select id="modal-backend-select" 
                                        class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base bg-white">
                                    <option value="deepseek">DeepSeek</option>
                                    <option value="openai">OpenAI</option>
                                    <option value="azure">Azure OpenAI</option>
                                    <option value="anthropic">Anthropic (Claude)</option>
                                    <option value="gemini">Google Gemini</option>
                                    <option value="openrouter">OpenRouter</option>
                                    <option value="aliyun">Aliyun</option>
                                    <option value="ollama">Ollama</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_model_label">å…¨å±€æ¨¡å‹ (å¯é€‰)</label>
                                <input type="text" id="modal-global-model-input" placeholder="é»˜è®¤æ¨¡å‹" data-i18n-placeholder="input_model_placeholder"
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base">
                            </div>
                            <div id="modal-global-reasoning-container" class="hidden">
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_reasoning_label">æ¨ç†å¼ºåº¦</label>
                                <select id="modal-global-reasoning-input" 
                                        class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base bg-white">
                                    <option value="" data-i18n="reasoning_off">å…³é—­</option>
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_rounds_label">è®¨è®ºè½®æ•°</label>
                                <input type="number" id="modal-rounds-input" value="3" min="1" max="10" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_planners_label">ç­–è®ºå®¶æ•°é‡</label>
                                <input type="number" id="modal-planners-input" value="2" min="1" max="5" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 uppercase mb-2" data-i18n="input_auditors_label">ç›‘å¯Ÿå®˜æ•°é‡</label>
                                <input type="number" id="modal-auditors-input" value="2" min="1" max="5" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg outline-none text-base">
                            </div>
                        </div>
                    </div>

                    <!-- å¸­ä½ä¸“å®¶é…ç½® Tab -->
                    <div id="tab-agents-content" class="hidden">
                        <div class="flex justify-between items-center mb-4">
                            <p class="text-sm text-slate-600" data-i18n="agent_config_desc">ä¸ºä¸åŒå¸­ä½çš„ä¸“å®¶æŒ‡å®šç‰¹å®šçš„æ¨¡å‹åç«¯å’Œå‚æ•°</p>
                            <button onclick="resetAgentConfigs()" class="text-xs text-blue-600 hover:text-blue-800 font-medium" data-i18n="advanced_reset">é‡ç½®ä¸ºé»˜è®¤</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="modal-agent-configs-container">
                            <!-- å›ºå®šçš„ Leader å’Œ Reporter -->
                            <div class="p-3 bg-slate-50 rounded-lg border border-slate-200">
                                <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center">
                                    <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span><span data-i18n="role_leader">è®®é•¿ (Leader)</span>
                                </h4>
                                <div class="flex gap-2">
                                    <select class="agent-backend flex-1 text-xs p-1 border rounded" data-agent="leader">
                                        <option value="default" data-i18n="backend_default">é»˜è®¤åç«¯</option>
                                        <option value="deepseek">DeepSeek</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="openrouter">OpenRouter</option>
                                        <option value="aliyun">Aliyun</option>
                                        <option value="ollama">Ollama</option>
                                    </select>
                                    <input type="text" class="agent-model flex-1 text-xs p-1 border rounded" placeholder="æ¨¡å‹åç§° (å¯é€‰)" data-i18n-placeholder="agent_model_placeholder" data-agent="leader">
                                </div>
                                <select class="agent-reasoning hidden text-[10px] p-1 border rounded mt-1 w-full" data-agent="leader">
                                    <option value="" data-i18n="reasoning_off">æ¨ç†: å…³é—­</option>
                                    <option value="low">æ¨ç†: Low</option>
                                    <option value="medium">æ¨ç†: Medium</option>
                                    <option value="high">æ¨ç†: High</option>
                                </select>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-lg border border-slate-200">
                                <h4 class="text-xs font-bold text-slate-500 uppercase mb-2 flex items-center">
                                    <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span><span data-i18n="role_reporter">è®°å½•å‘˜ (Reporter)</span>
                                </h4>
                                <div class="flex gap-2">
                                    <select class="agent-backend flex-1 text-xs p-1 border rounded" data-agent="reporter">
                                        <option value="default" data-i18n="backend_default">é»˜è®¤åç«¯</option>
                                        <option value="deepseek">DeepSeek</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="openrouter">OpenRouter</option>
                                        <option value="aliyun">Aliyun</option>
                                        <option value="ollama">Ollama</option>
                                    </select>
                                    <input type="text" class="agent-model flex-1 text-xs p-1 border rounded" placeholder="æ¨¡å‹åç§° (å¯é€‰)" data-i18n-placeholder="agent_model_placeholder" data-agent="reporter">
                                </div>
                                <select class="agent-reasoning hidden text-[10px] p-1 border rounded mt-1 w-full" data-agent="reporter">
                                    <option value="" data-i18n="reasoning_off">æ¨ç†: å…³é—­</option>
                                    <option value="low">æ¨ç†: Low</option>
                                    <option value="medium">æ¨ç†: Medium</option>
                                    <option value="high">æ¨ç†: High</option>
                                </select>
                            </div>
                            <!-- åŠ¨æ€ç”Ÿæˆçš„ Planners å’Œ Auditors å°†æ’å…¥åˆ°è¿™é‡Œ -->
                        </div>
                    </div>

                    <!-- å…ƒè€é™¢ç¼–åˆ¶ Tab -->
                    <div id="tab-presets-content" class="hidden space-y-6">
                        <!-- ä¿å­˜å½“å‰é…ç½® -->
                        <section class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <h3 class="font-bold text-slate-700 mb-3 flex items-center">
                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span> <span data-i18n="presets_save_new">ä¿å­˜å½“å‰é…ç½®ä¸ºæ–°ç¼–åˆ¶</span>
                            </h3>
                            <div class="flex gap-2">
                                <input type="text" id="modal-new-preset-name" placeholder="è¾“å…¥ç¼–åˆ¶åç§° (ä¾‹å¦‚: 3äºº-DeepSeek-é«˜å¼ºåº¦)" 
                                       data-i18n-placeholder="presets_name_placeholder"
                                       class="flex-1 px-3 py-2 border border-slate-300 rounded-lg outline-none focus:border-blue-500 transition">
                                <button onclick="saveModalPreset()" class="bg-green-600 hover:bg-green-700 text-white font-bold px-4 py-2 rounded-lg transition shadow-sm" data-i18n="btn_save">
                                    ä¿å­˜
                                </button>
                            </div>
                        </section>

                        <!-- ç¼–åˆ¶åˆ—è¡¨ -->
                        <section>
                            <h3 class="font-bold text-slate-700 mb-3 flex items-center">
                                <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span> <span data-i18n="presets_list">å·²ä¿å­˜çš„ç¼–åˆ¶</span>
                            </h3>
                            <div id="modal-presets-list" class="space-y-2 max-h-80 overflow-y-auto pr-2">
                                <!-- åŠ¨æ€æ’å…¥ -->
                                <div class="text-center text-gray-400 py-4">åŠ è½½ä¸­...</div>
                            </div>
                        </section>
                    </div>

                    <!-- ç³»ç»Ÿè®¾ç½® Tab -->
                    <div id="tab-settings-content" class="hidden space-y-6">
                        <!-- æ¨¡å‹APIå¯†é’¥é…ç½®åŒºåŸŸ -->
                        <section class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-100">
                            <h4 class="text-sm font-bold text-blue-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-blue-500 rounded-full mr-2"></span> 
                                <span class="mr-1">ğŸ¤–</span>
                                <span data-i18n="settings_api_keys">æ¨¡å‹ API å¯†é’¥é…ç½®</span>
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">DeepSeek API Key</label>
                                    <input type="password" id="settings-key-deepseek" placeholder="sk-..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">OpenAI API Key</label>
                                    <input type="password" id="settings-key-openai" placeholder="sk-..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Azure OpenAI API Key</label>
                                    <input type="password" id="settings-key-azure" placeholder="your-azure-key..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Azure OpenAI Endpoint</label>
                                    <input type="text" id="settings-azure-endpoint" placeholder="https://your-resource.openai.azure.cn" 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                    <p class="text-xs text-slate-500 mt-1">ä¸­å›½åŒº: .openai.azure.cn | å…¨çƒåŒº: .openai.azure.com</p>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Azure Deployment Name</label>
                                    <input type="text" id="settings-azure-deployment" placeholder="gpt-4o" 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                    <p class="text-xs text-slate-500 mt-1">æ‚¨åœ¨Azureåˆ›å»ºçš„éƒ¨ç½²åç§°ï¼ˆä¸æ˜¯æ¨¡å‹åï¼‰</p>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Anthropic API Key</label>
                                    <input type="password" id="settings-key-anthropic" placeholder="sk-ant-..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                    <p class="text-xs text-slate-500 mt-1">Claude APIå¯†é’¥ï¼ˆè·å–åœ°å€: console.anthropic.comï¼‰</p>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Google Gemini API Key</label>
                                    <input type="password" id="settings-key-gemini" placeholder="AIza..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                    <p class="text-xs text-slate-500 mt-1">Gemini APIå¯†é’¥ï¼ˆè·å–åœ°å€: aistudio.google.comï¼‰</p>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">OpenRouter API Key</label>
                                    <input type="password" id="settings-key-openrouter" placeholder="sk-or-..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Aliyun API Key</label>
                                    <input type="password" id="settings-key-aliyun" placeholder="sk-..." 
                                           class="w-full px-3 py-2 border border-blue-200 rounded-lg outline-none focus:border-blue-500 transition bg-white">
                                </div>
                            </div>
                        </section>

                        <!-- æœç´¢å¼•æ“é…ç½®åŒºåŸŸ -->
                        <section class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-100">
                            <h4 class="text-sm font-bold text-green-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-green-500 rounded-full mr-2"></span>
                                <span class="mr-1">ğŸ”</span>
                                <span data-i18n="settings_search_engines">æœç´¢å¼•æ“é…ç½®</span>
                            </h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-600 uppercase" data-i18n="settings_search_engines">æœç´¢å¢å¼ºå¼•æ“ (å¯å¤šé€‰)</label>
                                    <div id="settings-search-providers" class="grid grid-cols-2 gap-2">
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="bing" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Bing (<span data-i18n="search_stable">ä¸ç¨³å®š</span>)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="baidu" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Baidu (<span data-i18n="search_chinese">ä¸­æ–‡</span>)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="duckduckgo" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">DuckDuckGo</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="yahoo" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Yahoo (<span data-i18n="search_stable_good">ç¨³å®š</span>)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="mojeek" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Mojeek (<span data-i18n="search_english">è‹±æ–‡</span>)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="google" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Google (<span class="text-green-600 font-bold">API</span>)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 p-2 border border-green-200 rounded-lg hover:bg-white cursor-pointer transition bg-white/50">
                                            <input type="checkbox" value="tavily" class="search-provider-checkbox w-4 h-4 text-green-600 rounded focus:ring-green-500">
                                            <span class="text-sm text-slate-700">Tavily (Key)</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">Tavily API Key</label>
                                    <input type="password" id="settings-key-tavily" placeholder="tvly-..." 
                                           class="w-full px-3 py-2 border border-green-200 rounded-lg outline-none focus:border-green-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase flex items-center">
                                        <span class="mr-2">Google API Key</span>
                                        <a href="https://developers.google.com/custom-search/v1/overview" target="_blank" class="text-green-500 hover:text-green-700 text-xs">
                                            (è·å– â†—ï¸)
                                        </a>
                                    </label>
                                    <input type="password" id="settings-key-google" placeholder="AIzaSy..." 
                                           class="w-full px-3 py-2 border border-green-200 rounded-lg outline-none focus:border-green-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase flex items-center">
                                        <span class="mr-2">Google Search Engine ID</span>
                                        <a href="https://programmablesearchengine.google.com/" target="_blank" class="text-green-500 hover:text-green-700 text-xs">
                                            (è·å– â†—ï¸)
                                        </a>
                                    </label>
                                    <input type="text" id="settings-google-cx" placeholder="003ac4d2..." 
                                           class="w-full px-3 py-2 border border-green-200 rounded-lg outline-none focus:border-green-500 transition bg-white">
                                    <p class="text-xs text-slate-500 mt-1">
                                        ğŸ’¡ å…è´¹é…é¢ï¼š100æ¬¡/å¤© | ä»˜è´¹ï¼š$5/1000æ¬¡ | å›½å†…å¯è®¿é—®
                                    </p>
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase" data-i18n="settings_browser_path">æµè§ˆå™¨å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ (Baidu/Bing æœç´¢)</label>
                                    <input type="text" id="settings-browser-path" placeholder="ä¾‹å¦‚: C:\Program Files\Google\Chrome\Application\chrome.exe" 
                                           data-i18n-placeholder="settings_browser_path_placeholder"
                                           class="w-full px-3 py-2 border border-green-200 rounded-lg outline-none focus:border-green-500 transition bg-white">
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- ç”¨æˆ·è®¾ç½® Tab -->
                    <div id="tab-user-content" class="hidden space-y-6">
                        <!-- ç”¨æˆ·ä¿¡æ¯å±•ç¤º -->
                        <section class="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-100">
                            <h4 class="text-sm font-bold text-purple-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-purple-500 rounded-full mr-2"></span> 
                                <span class="mr-1">ğŸ‘¤</span>
                                <span data-i18n="user_info">ç”¨æˆ·ä¿¡æ¯</span>
                            </h4>
                            <div class="grid grid-cols-1 gap-3">
                                <div class="bg-white p-3 rounded-lg border border-purple-100">
                                    <label class="text-xs font-bold text-slate-500 uppercase">ç”¨æˆ·å</label>
                                    <p id="user-display-username" class="text-base text-slate-800 mt-1">åŠ è½½ä¸­...</p>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-purple-100">
                                    <label class="text-xs font-bold text-slate-500 uppercase">é‚®ç®±</label>
                                    <p id="user-display-email" class="text-base text-slate-800 mt-1">åŠ è½½ä¸­...</p>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-purple-100">
                                    <label class="text-xs font-bold text-slate-500 uppercase">åŒå› ç´ è®¤è¯</label>
                                    <p id="user-display-mfa" class="text-base text-slate-800 mt-1">
                                        <span class="inline-flex items-center">åŠ è½½ä¸­...</span>
                                    </p>
                                </div>
                            </div>
                        </section>

                        <!-- ä¿®æ”¹å¯†ç  -->
                        <section class="bg-gradient-to-br from-orange-50 to-red-50 p-4 rounded-xl border border-orange-100">
                            <h4 class="text-sm font-bold text-orange-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-orange-500 rounded-full mr-2"></span> 
                                <span class="mr-1">ğŸ”’</span>
                                <span data-i18n="change_password">ä¿®æ”¹å¯†ç </span>
                            </h4>
                            <div class="space-y-3">
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">å½“å‰å¯†ç </label>
                                    <input type="password" id="user-current-password" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " 
                                           class="w-full px-3 py-2 border border-orange-200 rounded-lg outline-none focus:border-orange-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">æ–°å¯†ç </label>
                                    <input type="password" id="user-new-password" placeholder="è‡³å°‘8ä½ï¼Œå«å¤§å°å†™å­—æ¯å’Œæ•°å­—" 
                                           class="w-full px-3 py-2 border border-orange-200 rounded-lg outline-none focus:border-orange-500 transition bg-white">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-bold text-slate-600 uppercase">ç¡®è®¤æ–°å¯†ç </label>
                                    <input type="password" id="user-confirm-password" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " 
                                           class="w-full px-3 py-2 border border-orange-200 rounded-lg outline-none focus:border-orange-500 transition bg-white">
                                </div>
                                <div class="text-xs text-slate-500 bg-white p-2 rounded border border-orange-100">
                                    âš ï¸ å¯†ç è¦æ±‚ï¼šè‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
                                </div>
                                <button onclick="changePassword()" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg font-bold transition shadow-lg">
                                    ä¿®æ”¹å¯†ç 
                                </button>
                            </div>
                        </section>

                        <!-- MFA ç®¡ç† -->
                        <section class="bg-gradient-to-br from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-100">
                            <h4 class="text-sm font-bold text-blue-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-blue-500 rounded-full mr-2"></span> 
                                <span class="mr-1">ğŸ”</span>
                                <span data-i18n="mfa_management">åŒå› ç´ è®¤è¯ç®¡ç†</span>
                            </h4>
                            <div id="mfa-status-container" class="space-y-3">
                                <!-- MFAçŠ¶æ€å°†åŠ¨æ€åŠ è½½ -->
                                <div class="text-center py-4 text-slate-500">åŠ è½½ä¸­...</div>
                            </div>
                        </section>

                        <!-- è´¦æˆ·æ“ä½œ -->
                        <section class="bg-gradient-to-br from-red-50 to-rose-50 p-4 rounded-xl border border-red-100">
                            <h4 class="text-sm font-bold text-red-800 mb-4 flex items-center">
                                <span class="w-1.5 h-4 bg-red-500 rounded-full mr-2"></span> 
                                <span class="mr-1">âš¡</span>
                                <span data-i18n="account_actions">è´¦æˆ·æ“ä½œ</span>
                            </h4>
                            <div class="space-y-3">
                                <button onclick="handleLogout()" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg font-bold transition shadow-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                    é€€å‡ºç™»å½•
                                </button>
                                <div class="text-xs text-slate-500 bg-white p-2 rounded border border-red-100">
                                    ğŸ’¡ æç¤ºï¼šä¿®æ”¹å¯†ç åï¼Œæ‰€æœ‰å…¶ä»–è®¾å¤‡å°†è‡ªåŠ¨ç™»å‡º
                                </div>
                            </div>
                        </section>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-end space-x-3">
                    <button onclick="toggleAdvancedConfigModal()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition" data-i18n="btn_cancel">
                        å–æ¶ˆ
                    </button>
                    <button onclick="applyAdvancedConfig()" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200" data-i18n="btn_apply">
                        åº”ç”¨
                    </button>
                </div>
            </div>
        </div>

        <!-- ç¼–åˆ¶ç®¡ç†æ¨¡æ€æ¡† (å·²åºŸå¼ƒï¼ŒåŠŸèƒ½ç§»è‡³é«˜çº§é…ç½®modal) -->

        <!-- è§’è‰²ç®¡ç†æ¨¡æ€æ¡† -->
        <div id="roles-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[150] flex items-center justify-center">
            <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl p-8 m-4 max-h-[90vh] flex flex-col transform transition-all scale-100">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black text-slate-800 flex items-center">
                        <span class="mr-3 text-3xl">ğŸ‘¥</span> <span data-i18n="roles_title">è§’è‰²ç®¡ç†</span>
                    </h2>
                    <div class="flex items-center space-x-3">
                        <button onclick="openRoleDesigner()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold rounded-lg transition shadow-lg flex items-center space-x-2">
                            <span>âœ¨</span>
                            <span>åˆ›å»ºæ–°è§’è‰²</span>
                        </button>
                        <button onclick="toggleRolesModal()" class="text-slate-400 hover:text-slate-600 transition">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>

                <!-- è§’è‰²åˆ—è¡¨ -->
                <div class="flex-1 overflow-y-auto pr-2">
                    <div id="roles-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- åŠ¨æ€æ’å…¥è§’è‰²å¡ç‰‡ -->
                        <div class="text-center text-gray-400 py-8">åŠ è½½ä¸­...</div>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-end">
                    <button onclick="toggleRolesModal()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition" data-i18n="btn_close">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- è§’è‰²è®¾è®¡å¸ˆæ¨¡æ€æ¡† (3æ­¥å‘å¯¼) -->
        <div id="role-designer-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[160] flex items-center justify-center">
            <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl p-8 m-4 max-h-[90vh] flex flex-col">
                <!-- æ ‡é¢˜ -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black text-slate-800 flex items-center">
                        <span class="mr-3 text-3xl">âœ¨</span> 
                        <span>AIè§’è‰²è®¾è®¡å¸ˆ</span>
                    </h2>
                    <button onclick="closeRoleDesigner()" class="text-slate-400 hover:text-slate-600 transition">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                <div class="flex items-center justify-center mb-6">
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center">
                            <div id="step-indicator-1" class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">1</div>
                            <span id="step-label-1" class="ml-2 font-bold text-blue-600">éœ€æ±‚æè¿°</span>
                        </div>
                        <div class="w-16 h-1 bg-slate-200">
                            <div id="step-progress-1" class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex items-center">
                            <div id="step-indicator-2" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-bold">2</div>
                            <span id="step-label-2" class="ml-2 text-slate-400">AIç”Ÿæˆ</span>
                        </div>
                        <div class="w-16 h-1 bg-slate-200">
                            <div id="step-progress-2" class="h-full bg-blue-600 transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex items-center">
                            <div id="step-indicator-3" class="w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-bold">3</div>
                            <span id="step-label-3" class="ml-2 text-slate-400">é¢„è§ˆä¿å­˜</span>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤å†…å®¹ -->
                <div class="flex-1 overflow-y-auto pr-2">
                    <!-- Step 1: éœ€æ±‚è¾“å…¥ -->
                    <div id="designer-step-1" class="space-y-4">
                        <p class="text-slate-600 mb-4">
                            æè¿°æ‚¨éœ€è¦çš„è§’è‰²åŠŸèƒ½å’Œç‰¹ç‚¹ï¼ŒAIå°†è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„è§’è‰²é…ç½®ã€‚
                        </p>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">è§’è‰²éœ€æ±‚ *</label>
                            <textarea id="role-requirement-input" 
                                      rows="8"
                                      class="w-full px-4 py-3 border border-slate-300 rounded-lg outline-none focus:border-blue-500 transition text-base"
                                      placeholder="ä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªæ“…é•¿æ•°æ®åˆ†æçš„è§’è‰²ï¼Œèƒ½å¤Ÿå¤„ç†ç»Ÿè®¡åˆ†æã€æ•°æ®å¯è§†åŒ–å’Œè¶‹åŠ¿é¢„æµ‹ä»»åŠ¡ã€‚è¿™ä¸ªè§’è‰²åº”è¯¥å…·å¤‡æ‰¹åˆ¤æ€§æ€ç»´ï¼Œè¾“å‡ºç»“æ„åŒ–çš„åˆ†ææŠ¥å‘Š..."></textarea>
                            <p class="text-xs text-slate-500 mt-2">ğŸ’¡ æç¤ºï¼šè¯¦ç»†æè¿°è§’è‰²çš„ä¸“ä¸šé¢†åŸŸã€å·¥ä½œæ–¹å¼å’Œè¾“å‡ºè¦æ±‚</p>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-bold text-blue-800 mb-2">ğŸ“‹ ç¤ºä¾‹éœ€æ±‚</h4>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>â€¢ å¸‚åœºè°ƒç ”å‘˜ï¼šæ”¶é›†è¡Œä¸šæ•°æ®ã€åˆ†æç«å“ç­–ç•¥ã€ç”ŸæˆSWOTæŠ¥å‘Š</li>
                                <li>â€¢ åˆ›æ„æ¿€å‘å®˜ï¼šå¤´è„‘é£æš´ã€è·¨é¢†åŸŸè”æƒ³ã€æ‰“ç ´å¸¸è§„æ€ç»´</li>
                                <li>â€¢ é£é™©è¯„ä¼°å¸ˆï¼šè¯†åˆ«æ½œåœ¨é£é™©ã€è¯„ä¼°å½±å“ç¨‹åº¦ã€æå‡ºç¼“è§£æªæ–½</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 2: ç”Ÿæˆä¸­ -->
                    <div id="designer-step-2" class="hidden space-y-4">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            <span class="text-lg text-slate-600">AIæ­£åœ¨ç”Ÿæˆè§’è‰²è®¾è®¡...</span>
                        </div>
                        
                        <!-- Reasoningæ˜¾ç¤ºåŒº -->
                        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <svg class="w-5 h-5 text-amber-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                                </svg>
                                <h4 class="font-bold text-amber-800">AIæ€è€ƒè¿‡ç¨‹</h4>
                            </div>
                            <div id="reasoning-display" class="text-sm text-amber-900 whitespace-pre-wrap max-h-48 overflow-y-auto font-mono bg-white rounded p-3 border border-amber-100"></div>
                        </div>
                        
                        <!-- Contentæ˜¾ç¤ºåŒº -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <svg class="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
                                </svg>
                                <h4 class="font-bold text-blue-800">ç”Ÿæˆå†…å®¹</h4>
                            </div>
                            <div id="content-display" class="text-sm text-blue-900 whitespace-pre-wrap max-h-48 overflow-y-auto font-mono bg-white rounded p-3 border border-blue-100"></div>
                        </div>
                    </div>

                    <!-- Step 3: é¢„è§ˆå’Œç¼–è¾‘ -->
                    <div id="designer-step-3" class="hidden space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <p class="text-green-800 font-bold">âœ… è§’è‰²è®¾è®¡å®Œæˆï¼æ‚¨å¯ä»¥é¢„è§ˆå¹¶è°ƒæ•´åä¿å­˜ã€‚</p>
                        </div>

                        <!-- è§’è‰²åŸºæœ¬ä¿¡æ¯ -->
                        <section class="bg-slate-50 rounded-lg p-4">
                            <h4 class="font-bold text-slate-700 mb-3">åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">æŠ€æœ¯åç§°</label>
                                    <input type="text" id="preview-role-name" readonly
                                           class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 mb-1">æ˜¾ç¤ºåç§°</label>
                                    <input type="text" id="preview-display-name" 
                                           class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm">
                                </div>
                            </div>
                            <div class="mt-3">
                                <label class="block text-xs font-bold text-slate-500 mb-1">è§’è‰²æè¿°</label>
                                <textarea id="preview-description" rows="3"
                                          class="w-full px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm"></textarea>
                            </div>
                        </section>

                        <!-- é˜¶æ®µå®šä¹‰ -->
                        <section class="bg-slate-50 rounded-lg p-4">
                            <h4 class="font-bold text-slate-700 mb-3">å·¥ä½œé˜¶æ®µ</h4>
                            <div id="preview-stages-container" class="space-y-3">
                                <!-- åŠ¨æ€æ’å…¥é˜¶æ®µå¡ç‰‡ -->
                            </div>
                        </section>

                        <!-- æ¨èäººç‰© -->
                        <section class="bg-slate-50 rounded-lg p-4">
                            <h4 class="font-bold text-slate-700 mb-3">æ¨èäººç‰©åŸå‹</h4>
                            <div id="preview-personas-container" class="space-y-2">
                                <!-- åŠ¨æ€æ’å…¥äººç‰©å¡ç‰‡ -->
                            </div>
                        </section>
                    </div>
                </div>

                <!-- åº•éƒ¨æŒ‰é’® -->
                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-between">
                    <button id="designer-back-btn" onclick="designerGoBack()" class="hidden px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                        â† è¿”å›
                    </button>
                    <div></div> <!-- å ä½ -->
                    <div class="space-x-3">
                        <button onclick="closeRoleDesigner()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                            å–æ¶ˆ
                        </button>
                        <button id="designer-next-btn" onclick="designerNextStep()" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200">
                            å¼€å§‹ç”Ÿæˆ â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡† -->
        <div id="role-detail-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[160] flex items-center justify-center">
            <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl p-8 m-4 max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 id="detail-role-name" class="text-2xl font-bold text-slate-800"></h3>
                        <p id="detail-role-desc" class="text-sm text-slate-600 mt-1"></p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="closeRoleDetail()" class="text-slate-400 hover:text-slate-600 transition">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>
                
                <div id="detail-role-content" class="flex-1 overflow-y-auto pr-2 space-y-4">
                    <!-- åŠ¨æ€æ’å…¥è§’è‰²è¯¦æƒ… -->
                </div>
                
                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-end">
                    <button onclick="closeRoleDetail()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- è§’è‰²ç¼–è¾‘æ¨¡æ€æ¡† -->
        <div id="role-edit-modal" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[160] flex items-center justify-center">
            <div class="bg-white w-full max-w-5xl rounded-2xl shadow-2xl p-8 m-4 max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black text-slate-800 flex items-center">
                        <span class="mr-3 text-3xl">âœï¸</span> <span>ç¼–è¾‘è§’è‰²: <span id="edit-role-name" class="text-blue-600"></span></span>
                    </h2>
                    <button onclick="closeRoleEditor()" class="text-slate-400 hover:text-slate-600 transition">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto pr-2 space-y-6">
                    <!-- YAMLé…ç½®ç¼–è¾‘ -->
                    <section>
                        <label class="block text-sm font-bold text-slate-700 mb-2">è§’è‰²é…ç½® (YAML)</label>
                        <textarea id="role-yaml-editor" 
                                  class="w-full h-64 px-3 py-2 border border-slate-300 rounded-lg font-mono text-sm outline-none focus:border-blue-500 transition"
                                  placeholder="åŠ è½½ä¸­..."></textarea>
                        <p class="text-xs text-slate-500 mt-1">âš ï¸ è¯·ç¡®ä¿YAMLæ ¼å¼æ­£ç¡®ï¼Œä¿®æ”¹nameã€stagesç­‰å­—æ®µè¯·è°¨æ…</p>
                    </section>

                    <!-- Promptç¼–è¾‘åŒº -->
                    <section>
                        <label class="block text-sm font-bold text-slate-700 mb-2">æç¤ºè¯å†…å®¹</label>
                        <div id="prompt-editors" class="space-y-4">
                            <!-- åŠ¨æ€æ’å…¥å„é˜¶æ®µçš„promptç¼–è¾‘å™¨ -->
                        </div>
                    </section>
                </div>

                <div class="mt-6 pt-4 border-t border-slate-100 flex justify-between">
                    <button onclick="validateRoleConfig()" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                        éªŒè¯é…ç½®
                    </button>
                    <div class="space-x-3">
                        <button onclick="closeRoleEditor()" class="px-6 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition">
                            å–æ¶ˆ
                        </button>
                        <button onclick="saveRoleConfig()" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition shadow-lg shadow-blue-200">
                            ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡å—åŒ–JavaScriptå…¥å£ -->
        <script type="module" src="/static/js/main.js"></script>
    </main>
    <footer class="fixed bottom-0 right-0 p-2 text-xs text-gray-400">
        v{{ version }}
    </footer>
</body>
</html>
